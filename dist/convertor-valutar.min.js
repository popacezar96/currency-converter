/*! convertor-valutar 24-07-2021 */

const select=document.querySelectorAll(".form-select"),number=document.getElementById("number"),output=document.getElementById("output"),cadru=document.getElementById("schimbare"),switch_btn=document.getElementById("switch-button"),save_btn=document.getElementById("save-button"),remove_btn=document.createElement("button");remove_btn.textContent="Remove all",remove_btn.setAttribute("class","btn btn-secondary poz-btn-remove");const buttons_div=document.getElementById("buttons-div"),left=document.querySelector(".from"),right=document.querySelector(".to"),tableref=document.querySelector(".table"),tableBody=tableref.querySelector(".table-body"),tableHead=tableref.querySelector(".table-head");var database,idb_request;fetch("https://api.frankfurter.app/currencies").then(e=>e.json()).then(e=>{for(var t=Object.entries(e),n=0;n<t.length;n++)select[0].innerHTML+=`<option value=${t[n][0]}>${t[n][0]} : ${t[n][1]}</option>`,select[1].innerHTML+=`<option value=${t[n][0]}>${t[n][0]} : ${t[n][1]}</option>`}),cadru.addEventListener("input",e=>{convert()}),switch_btn.onclick=function(){var e=select[0].value,t=select[1].value;select[0].value=t,select[1].value=e,convert()},(idb_request=window.indexedDB.open("indexed-db",1)).addEventListener("error",function(e){alert("Could not open Indexed DB due to error: "+this.errorCode)}),idb_request.addEventListener("upgradeneeded",function(e){(database=this.result).createObjectStore("data",{autoIncrement:!0})}),idb_request.addEventListener("success",function(e){var t=(database=this.result).transaction("data","readwrite").objectStore("data");t.count().addEventListener("success",function(e){var a=this.result;0<a&&t.getAll().addEventListener("success",function(e){var t=this.result;let n,o;for(let e=a-1;0<=e;e--)o=t[e],n=tableBody.insertRow(),n.insertCell(0).textContent=o.conversie,n.insertCell(1).textContent=o.ora,n.insertCell(2).textContent=o.data;buttons_div.appendChild(remove_btn),tableHead.style.display="table-header-group"})})});let col0,col1,col2,col_arr,today,time,date,rezultat,newRow,newCell;function convert(){let t=select[0].value,n=select[1].value,o=number.value;t!=n&&0!==Number(o)?fetch(`https://api.frankfurter.app/latest?from=${t}&to=${n}`).then(e=>e.json()).then(e=>{output.value=(e.rates[n]*o).toFixed(3),left.textContent=`1 ${t}`,right.textContent=`${e.rates[n]} ${n}`}):(output.value=number.value,t===n?left.textContent=right.textContent=`1 ${t}`:(left.textContent=`0 ${t}`,right.textContent=`0 ${n}`))}save_btn.onclick=function(){var e=tableBody.rows.length;tableHead.style.display="table-header-group",today=new Date,time=today.getHours()+":"+today.getMinutes()+":"+today.getSeconds(),date=today.getFullYear()+"-"+(today.getMonth()+1)+"-"+today.getDate(),rezultat=`${0!==Number(number.value)?number.value:0} ${select[0].value} = ${0!==Number(output.value)?output.value:0} ${select[1].value}`,col0=document.createTextNode(`${rezultat}`),col1=document.createTextNode(`${time}`),col2=document.createTextNode(`${date}`),col_arr=[col0,col1,col2],newRow=0===e?tableBody.insertRow(e):tableBody.insertRow(0);for(let e=0;e<3;e++)newCell=newRow.insertCell(e),newCell.appendChild(col_arr[e]);buttons_div.childElementCount<2&&buttons_div.appendChild(remove_btn),database.transaction("data","readwrite").objectStore("data").add({conversie:`${rezultat}`,ora:`${time}`,data:`${date}`},`${e}`),e++},remove_btn.onclick=function(){for(tableHead.style.display="none";tableBody.firstChild;)tableBody.removeChild(tableBody.lastChild);buttons_div.removeChild(buttons_div.lastChild),database.transaction("data","readwrite").objectStore("data").clear()};
